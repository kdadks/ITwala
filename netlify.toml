[build]
  command = "npm run build"
  publish = ".next"

[build.environment]
  NODE_ENV = "production"

[[plugins]]
  package = "@netlify/plugin-nextjs"

# Scheduled Functions
[functions]
  directory = "netlify/functions"

# Analytics aggregation - runs daily at 2 AM UTC
[functions.scheduled-analytics-aggregation]
  schedule = "0 2 * * *"

# Static file handling for images and assets
[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.css"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/*.js"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Handle dynamic course pages
[[redirects]]
  from = "/courses/:slug"
  to = "/courses/[slug]"
  status = 200

# Handle dynamic dashboard pages  
[[redirects]]
  from = "/dashboard/course/:slug"
  to = "/dashboard/course/[slug]"
  status = 200

# Handle admin course management
[[redirects]]
  from = "/admin/courses/edit/:slug"
  to = "/admin/courses/edit/[slug]"
  status = 200

# SEO redirects (permanent)
[[redirects]]
  from = "/course/:slug"
  to = "/courses/:slug"
  status = 301

[[redirects]]
  from = "/ai-courses"
  to = "/courses?category=Artificial Intelligence"
  status = 301

[[redirects]]
  from = "/machine-learning-courses"
  to = "/courses?category=Machine Learning"
  status = 301

[[redirects]]
  from = "/data-science-courses"
  to = "/courses?category=Data Science"
  status = 301

# Environment-specific settings
[context.production.environment]
  NODE_ENV = "production"

[context.deploy-preview.environment]
  NODE_ENV = "development"

[context.branch-deploy.environment]
  NODE_ENV = "development"
